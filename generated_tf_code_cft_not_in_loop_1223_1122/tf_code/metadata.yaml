# Generated by AI. May require manual review.
apiVersion: blueprints.cloud.google.com/v1alpha1
kind: TerraformBlueprint
metadata:
  name: terraform-google-app-engine
  source:
    type: git
    location: https://github.com/GoogleCloudPlatform/terraform-google-app-engine.git # Sourced from a hypothetical repository
spec:
  info:
    title: Google Cloud App Engine Module
    version: 1.0.0 # Example version
    actuationTool:
      type: Terraform
      versions: [ ">= 1.3" ]
    description:
      tagline: Deploy and manage scalable applications on Google App Engine.
      detailed: This module handles the deployment of a complete Google App Engine application, including standard and flexible services, custom domain mappings, and firewall rules.
    examples:
      - name: simple_standard_service
        location: examples/simple_standard_service
        title: Simple Standard Service
        description: A basic example deploying a single App Engine standard service.
    labels:
      appengine: ""
      gcp: ""
      serverless: ""

  content:
    # Diagrams and documentation links are hypothetical
    diagrams:
      - name: architecture.png
        description: A high-level architecture diagram of the App Engine module.
    documentations:
      - title: README
        location: README.md
        description: Module documentation.

  interfaces:
    variables:
      - name: project_id
        description: "The ID of the Google Cloud project where the App Engine application will be created."
        varType: string
        required: true
      - name: location_id
        description: "The location to serve the App Engine application from. This will be the region for the app."
        varType: string
        required: true
      - name: database_type
        description: "The type of database to use with the App Engine application. Can be 'CLOUD_FIRESTORE' or 'CLOUD_DATASTORE_COMPATIBILITY'."
        varType: string
        defaultValue: null
        required: false
      - name: auth_domain
        description: "The GSuite domain to associate with the application for authentication."
        varType: string
        defaultValue: null
        required: false
      - name: iap
        description: "Settings for Identity-Aware Proxy. If set, IAP will be configured for the application."
        varType: object
        defaultValue: null
        required: false
      - name: standard_services
        description: "A map of App Engine Standard services to deploy. The key of the map is a logical name for the service version resource. Only one of 'automatic_scaling', 'basic_scaling', or 'manual_scaling' can be configured for each service."
        varType: map(object)
        defaultValue: {}
        required: false
      - name: flexible_services
        description: "A map of App Engine Flexible services to deploy. The key of the map is a logical name for the service version resource. The `service_account` attribute can be used to specify a user-managed service account for the instances, which will require appropriate permissions (e.g., `roles/storage.objectViewer`, `roles/logging.logWriter`)."
        varType: map(object)
        defaultValue: {}
        required: false
      - name: custom_domains
        description: "A list of custom domains to map to the App Engine application."
        varType: list(object)
        defaultValue: []
        required: false
      - name: firewall_rules
        description: "A list of firewall rules to apply to the App Engine application."
        varType: list(object)
        defaultValue: []
        required: false
    variableGroups:
      - name: "Application Settings"
        description: "Core settings for the App Engine application."
        variables:
          - project_id
          - location_id
          - database_type
          - auth_domain
      - name: "Service Configuration"
        description: "Define the Standard and Flexible services to deploy."
        variables:
          - standard_services
          - flexible_services
      - name: "Networking and Security"
        description: "Configure custom domains, firewall rules, and IAP."
        variables:
          - custom_domains
          - firewall_rules
          - iap
    outputs:
      - name: id
        description: "The full resource ID of the App Engine application."
      - name: name
        description: "The name of the App Engine application, which is the project ID."
      - name: url_dispatch_rules
        description: "The URL dispatch rules for the application, as a list of maps."
      - name: default_hostname
        description: "The default hostname for this application."
      - name: gcr_domain
        description: "The GCR domain used for storing managed Docker images for this app."
      - name: standard_services
        description: "A map of the deployed App Engine Standard services and their attributes."
      - name: flexible_services
        description: "A map of the deployed App Engine Flexible services and their attributes."
      - name: domain_mappings
        description: "A map of the configured custom domain mappings."
      - name: firewall_rules
        description: "A map of the configured firewall rules."

  requirements:
    roles:
      - level: project
        role: roles/appengine.appAdmin
      - level: project
        role: roles/storage.admin # Needed for the default GCS bucket creation
      - level: project
        role: roles/cloudbuild.builds.editor # App Engine uses Cloud Build for deployments
      - level: project
        role: roles/iam.serviceAccountUser # For the deployer to act as the App Engine service account
    services:
      - appengine.googleapis.com
      - cloudbuild.googleapis.com
      - storage.googleapis.com
      - logging.googleapis.com
      - monitoring.googleapis.com
      - iap.googleapis.com # Required if IAP is configured
      - compute.googleapis.com # Required for App Engine Flexible Environment
      - artifactregistry.googleapis.com # Required for container images in App Engine Flex
